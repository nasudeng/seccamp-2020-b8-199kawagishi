# seccamp20_b8事前課題
## 選択B_川岸寛明（no.199）

---
### 環境
Ubuntu20.04 (on WSL2 on Win10home1909)

---
### 課題1

- ユーザの新規作成
- 既存ユーザのname/email更新
- 既存ユーザの削除

1. 現在のテーブルの状態

```
seccamp_development=# select * from users;
 id |    name     |      email       |         created_at         |         updated_at
----+-------------+------------------+----------------------------+----------------------------
  1 | te_11211700 | te_111211700@nas | 2020-11-21 07:58:05.399612 | 2020-11-21 07:58:05.399612
  2 | te_11211705 | te_11211705@nas  | 2020-11-21 07:58:24.249533 | 2020-11-21 07:58:24.249533
  3 | te_11212055 | te_11212055@nas  | 2020-11-21 11:51:58.515693 | 2020-11-21 11:51:58.515693
(3 rows)
```
2. ユーザの新規作成

```
seccamp_development=# insert into users values (4,'te_11212100','te_11212100@nas','2020-11-21 11:56:58.515693','2020-
11-21 11:56:58.515693');
INSERT 0 1
seccamp_development=# select * from users;
 id |    name     |      email       |         created_at         |         updated_at
----+-------------+------------------+----------------------------+----------------------------
  1 | te_11211700 | te_111211700@nas | 2020-11-21 07:58:05.399612 | 2020-11-21 07:58:05.399612
  2 | te_11211705 | te_11211705@nas  | 2020-11-21 07:58:24.249533 | 2020-11-21 07:58:24.249533
  3 | te_11212055 | te_11212055@nas  | 2020-11-21 11:51:58.515693 | 2020-11-21 11:51:58.515693
  4 | te_11212100 | te_11212100@nas  | 2020-11-21 11:56:58.515693 | 2020-11-21 11:56:58.515693
(4 rows)
```

3. 既存ユーザのname/email更新

```
seccamp_development=# update users set name = 'et_11212055', email = 'et_11212055@nas' where id =3;
UPDATE 1
seccamp_development=# select * from users order by id;
 id |    name     |      email       |         created_at         |         updated_at
----+-------------+------------------+----------------------------+----------------------------
  1 | te_11211700 | te_111211700@nas | 2020-11-21 07:58:05.399612 | 2020-11-21 07:58:05.399612
  2 | te_11211705 | te_11211705@nas  | 2020-11-21 07:58:24.249533 | 2020-11-21 07:58:24.249533
  3 | et_11212055 | et_11212055@nas  | 2020-11-21 11:51:58.515693 | 2020-11-21 11:51:58.515693
  4 | te_11212100 | te_11212100@nas  | 2020-11-21 11:56:58.515693 | 2020-11-21 11:56:58.515693
(4 rows)
```

4. 既存ユーザの削除

```
seccamp_development=# delete from users where id = 2;
DELETE 1
seccamp_development=# select * from users order by id;
 id |    name     |      email       |         created_at         |         updated_at
----+-------------+------------------+----------------------------+----------------------------
  1 | te_11211700 | te_111211700@nas | 2020-11-21 07:58:05.399612 | 2020-11-21 07:58:05.399612
  3 | et_11212055 | et_11212055@nas  | 2020-11-21 11:51:58.515693 | 2020-11-21 11:51:58.515693
  4 | te_11212100 | te_11212100@nas  | 2020-11-21 11:56:58.515693 | 2020-11-21 11:56:58.515693
(3 rows)
```

---

### 課題2

- Micropostsの詳細を表示する箇所でDBから取り出したcontentの内容をRedisにキャッシュする

`micropost_controller.rb`の一部を以下のように書き換えた


```
def show
  cache = ActiveSupport::Cache::RedisCacheStore.new
  #cacheが存在しない場合のみ上式を実行したかったが方法が分からなかった

  if cache.fetch(params[:id]) == nil then
    #キャッシュに値が存在するかチェック

    cache.write(params[:id],@micropost.content)
    #存在しない場合はキャッシュに値を書き込む
  else
    @micropost.content = cache.fetch(params[:id])
    #存在する場合はキャッシュから値を取得する
  end
end
```
